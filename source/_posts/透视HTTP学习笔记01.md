---
title: 透视HTTP学习笔记01
date: 2022-03-02 22:24:21
tags:
---

HTTP 不完全记录

<!--more -->

#### 0.HTTP 是什么，HTTP 不是什么？

#### 1.PART1

##### 1.浏览器/服务器/CDN/爬虫

浏览器：协议的请求方，其角色被称为 User Agent，意思是作为访问者的代理发起 HTTP 请求。aka 客户端

服务器：协议的应答方，HTTP 响应请求的主体，分为硬件和软件。

`当我们谈到“Web 服务器”时有两个层面的含义：硬件和软件。
硬件含义就是物理形式或“云”形式的机器，在大多数情况下它可能不是一台服务器，而是利用反向代理、负载均衡等技术组成的庞大集群。但从外界看来，它仍然表现为一台机器，但这个形象是“虚拟的”。
软件含义的 Web 服务器可能我们更为关心，它就是提供 Web 服务的应用程序，通常会运行在硬件含义的服务器上。它利用强大的硬件能力响应海量的客户端 HTTP 请求，处理磁盘上的网页、图片等静态文件，或者把请求转发给后面的 Tomcat、Node.js 等业务应用，返回动态的信息。`

CDN：缩短浏览器到服务器的距离，它全程内容分发网络，应用了HTTP协议里的缓存和代理技术，代替源站响应客户端的请求。

爬虫：

##### 2.HTML/WebService/WAF

WebService 是一种应用服务开发规范，由 W3C 定义。（规定应用如何开发服务的规范？）通常使用 WSDL 定义服务接口，用 HTTP 协议传输 XML 或者 SOAP 信息。在 WebService 架构里，服务端和客户端可以用不同的编程语言。

#### 2.与HTTP相关的协议

##### 2.1TCP/IP 

一系列通信协议的同称，最重要的是 TCP 和 IP，还有 UDP、ICMP、ARP。

**IP**：主要解决寻址和路由的问题，以及两点减传送数据包。使用 IP 地址来定位计算机，分为 V4 版 （四个点分割地址，2 的 32 次方）和 V6版（8 个冒号分割地址，2 的 128 次方）

**TCP**：传输控制协议，位于 IP 协议之上。基于IP协议提供**可靠的，字节流**的通信。可靠意味着保证数据不丢失，字节流表示保证数据完整，所以在 TCP 两端可以如同操作文件一样访问传输的数据，就像是在一个密闭的管道里流动的字节。

**HTTP 与 TCP/IP**:HTTP 不关心传输细节，像寻址路由数据完整性等，这些都交给下层处理。所以 HTTP 就运行在 TCP/IP 协议上。

##### 2.2DNS

- DNS 是一个域名系统，域名又称为主机名。域名和IP地址是一组映射，但是域名比IP地址好记忆得多。不过 TCP/IP 使用的是 IP 地址，所以仍然需要 DNS 来解析域名为IP地址。HTTP 协议中并没有明确必须使用 DNS，但是现在大多数 WEB 服务器都使用了 DNS。
- DNS 解析域名的过程

DNS 是一个树状的分布式查询系统：比如说 www.baidu.com 从上往下为 根域名服务器返回顶级域名的IP地址(com 的 ip 地址)，顶级域名服务器(返回 baidu.com 的 ip 地址)，权威域名服务器(返回主机域名 www.baidu.com 的IP地址)

外层有多级缓存来实现负载均衡。像如上过程，如果每次都这么查找，对DNS 服务器的负载要求很大，所以需要缓存系统。我们按照顺序如果在缓存系统里找到了域名对应的ip地址，就不用再走这么一趟了。从小到大的缓存方：各个大公司、网络运营商的 DNS服务器=> 操作系统=>主机映射文件(hosts 文件，Windows 下是 C:\Windows\System32\drivers\etc)。

所以解析域名的过程大致是这样：浏览器=>操作系统=>hosts文件=>非权威DNS服务器=>根域名服务器=>顶级域名服务器权威DNS服务器。

##### 2.3URI/URL

URI 和 URL 基本无差别。URI 是统一资源定位符，唯一标记互联网上的资源，常用表现形式是 URL，URL 实际上是 URI 的子集。

URI 分为三部分：协议，主机名，路径

```
http://nginx.org/en/download.html
```

协议：http

主机名：nginx.org

路径：主机下的 "en/download.html"

##### 2.4HTTPS 

HTTPS 相当于加密了的 HTTP。它基于 SSL/TLS  上，而 SSL/TLS 又基于 TCP/IP。所以 HTTPS 相当于 TCP/IP + SSL/TLS + HTTP.

SSL 和 TLS 其实都是一个东西，是负责加密通信的安全协议，使用了对称加密，非对称加密，摘要算法，数字前面。数字证书等密码学先进的研究成果。

##### 2.5代理

是 HTTP 协议中请求方和应答方之间的一个环节，做为中转站，既可以转发客户端的请求，也可以转发服务器的应答。常见的有**四种**：

**匿名代理**：完全“隐匿”了被代理的机器，外界看到的只是代理服务器；
**透明代理：**顾名思义，它在传输过程中是“透明开放”的，外界既知道代理，也知道客户端；
**正向代理**：靠近客户端，代表客户端向服务器发送请求；
**反向代理**：靠近服务器端，代表服务器响应客户端的请求；

代理可以完成很多事情：负载均衡，内容缓存，安全防护，数据处理。

**负载均衡**：把访问请求均匀分散到多台机器，实现访问集群化；
**内容缓存**：暂存上下行的数据，减轻后端的压力；
**安全防护**：隐匿 IP, 使用 WAF 等工具抵御网络攻击，保护被代理的机器；
**数据处理**：提供压缩、加密等额外的功能。

##### 2.6问题

- DNS 和 URL：DNS 解析到主机名，变成 IP 地址后，IP地址再进行寻址和路由。
- 代理的类型区分：a 和 b 交流，通过 c 转达，是正向代理。b 知道 a 透明，b 不知道 a 匿名。b 又通过 c 或者其它的谁回复，此时b 或者其它谁就是反向代理。

#### 3.TCP/IP 分层

从下到上分为四层：链接层，网络层，传输层，应用层。

只要关心的是具体应用内容，就是应用层，比如 CDN DNS



`第一层叫“链接层”（link layer），负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 MAC 地址来标记网络上的设备，所以有时候也叫 MAC 层。
第二层叫“网际层”或者“网络互连层”（internet layer），IP 协议就处在这一层。因为 IP 协议定义了“IP 地址”的概念，所以就可以在“链接层”的基础上，用 IP 地址取代 MAC 地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把 IP 地址再“翻译”成 MAC 地址就可以了。
第三层叫“传输层”（transport layer），这个层次协议的职责是保证数据在 IP 地址标记的两点之间“可靠”地传输，是 TCP 协议工作的层次，另外还有它的一个“小伙伴”UDP。
TCP 是一个有状态的协议，需要先与对方建立连接然后才能发送数据，而且保证数据不丢失不重复。而 UDP 则比较简单，它无状态，不用事先建立连接就可以任意发送数据，但不保证数据一定会发到对方。两个协议的另一个重要区别在于数据的形式。TCP 的数据是连续的“字节流”，有先后顺序，而 UDP 则是分散的小数据包，是顺序发，乱序收。
协议栈的第四层叫“应用层”（application layer），由于下面的三层把基础打得非常好，所以在这一层就“百花齐放”了，有各种面向具体应用的协议。例如 Telnet、SSH、FTP、SMTP 等等，当然还有我们的 HTTP。
MAC 层的传输单位是帧（frame），IP 层的传输单位是包（packet），TCP 层的传输单位是段（segment），HTTP 的传输单位则是消息或报文（message）。但这些名词并没有什么本质的区分，可以统称为数据包。`

#### 4.OSI网络分层

分为七层，物理层(第一层)，数据链路层，网络层，传输层，会话层，表示层，应用层(第七层)

与 TCP/IP 的映射关系，第一层没有，第二三四层分别对应，第五六七对应 应用层

二层转发：OSI 中数据链路层设备(交换机)通过 MAC 地址来决定转发到哪个端口

三层路由：OSI 中网络层设备(路由器)通过 IP 地址来决定路由到哪个网络

` 所谓的“四层负载均衡”就是指工作在传输层上，基于 TCP/IP 协议的特性，例如 IP 地址、端口号等实现对后端服务器的负载均衡。
  所谓的“七层负载均衡”就是指工作在应用层上，看到的是 HTTP 协议，解析 HTTP 报文里的 URI、主机名、资源类型等数据，再用适当的策略转发给后端服务器。`

#### 5.TCP/IP 四层模型的传输过程

传递：从上往下。HTTP 给数据套上 HTTP 专用附加数据，到传输层加 TCP 头，到网络层加 IP头，到链路层加 MAC头。

接受：从下往上。数据从链路层过来，去除 MAC 层，IP 层加的东西，去除 TCP 加的东西，去除 HTTP 加的东西，拿到数据。

下层的传输过程对于上层来说是透明的，所以就 HTTP 层来看，下层只是一个可靠的传输链路。
